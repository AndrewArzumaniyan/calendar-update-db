# calendar-update-db

## Отчет о функциях из bd.py

### Общие функции

1. **print_table(table_name: str)**
    - **Описание:** Данная функция используется для вывода содержимого указанной таблицы в базе данных.
    - **Входные параметры:** `table_name` (строка) - имя таблицы, содержимое которой необходимо вывести.
    - **Возвращает:** Не возвращает, а выводит содержимое таблицы в консоль.

2. **add_info(table_name: str, columns: list, values: list)**
    - **Описание:** Функция предназначена для добавления информации в указанную таблицу в базе данных.
    - **Входные параметры:** `table_name` (строка) - имя таблицы, `columns` (список) - список названий столбцов, `values` (список) - список значений для добавления в таблицу.
    - **Возвращает:** Не возвращает, а выводит сообщение о добавлении данных или об ошибке.

### Работа с пользователями

3. **get_user_by_telegram(telegram_id: int)**
    - **Описание:** Эта функция получает информацию о пользователе по `telegram_id`.
    - **Входные параметры:** `telegram_id` (целое число) - ID пользователя в Telegram.
    - **Возвращает:** Словарь с информацией о пользователе (если он найден), иначе `None`.

4. **get_director()**
    - **Описание:** Данная функция получает информацию о пользователе с ролью 'director'.
    - **Входные параметры:** Отсутствуют.
    - **Возвращает:** Словарь с информацией о директоре (если найден), иначе `None`.

5. **check_telegram_id(telegram_id: int)**
    - **Описание:** Проверяет наличие пользователя по `telegram_id`.
    - **Входные параметры:** `telegram_id` (целое число) - ID пользователя в Telegram.
    - **Возвращает:** `True`, если пользователь с таким `telegram_id` существует, иначе `False` или `None`.

6. **add_password(customer_id: int, password: str)**
    - **Описание:** Добавляет пароль пользователю с указанным `customer_id`.
    - **Входные параметры:** `customer_id` (целое число) - ID пользователя, `password` (строка) - пароль для установки.
    - **Возвращает:** Не возвращает, а выводит сообщение об успешном обновлении данных или об ошибке.

7. **get_customer_by_email(email: str)**
    - **Описание:** Получает информацию о пользователе по его электронной почте.
    - **Входные параметры:** `email` (строка) - электронная почта пользователя.
    - **Возвращает:** Словарь с информацией о пользователе (если он найден), иначе `None`.

### Работа с событиями

8. **get_events(customer_id: int)** - вместо get_event_info()
    - **Описание:** Получает события для указанного пользователя, у которых время окончания больше текущего времени.
    - **Входные параметры:** `customer_id` (целое число) - ID пользователя.
    - **Возвращает:** Список словарей с информацией о событиях (если они найдены), иначе `None`.

9. **update_event(event_id: str, event_name: str, event_start, event_end, event_last_modified)** - функция для разработки (в боте не используется)
    - **Описание:** Обновляет информацию о событии.
    - **Входные параметры:** `event_id` (строка) - ID события, `event_name` (строка) - название события, `event_start` - время начала события, `event_end` - время окончания события, `event_last_modified` - время последнего изменения события.
    - **Возвращает:** Не возвращает, а выводит сообщение об успешном обновлении данных или об ошибке.

10. **delete_timeout_events()** - функция для разработки (в боте не используется)
    - **Описание:** Удаляет события, время окончания которых меньше текущего времени.
    - **Входные параметры:** Отсутствуют.
    - **Возвращает:** Не возвращает, а выводит сообщение об успешном удалении данных или об ошибке.

11. **delete_event(event_id: str)** - фукнция для разработки (в боте не используется)
    - **Описание:** Удаляет событие по его ID.
    - **Входные параметры:** `event_id` (строка) - ID события.
    - **Возвращает:** Не возвращает, а выводит сообщение об успешном удалении данных или об ошибке.

### Управление доступами

12. **get_accesses(customer_id: int)**
    - **Описание:** Получает доступы для указанного пользователя.
    - **Входные параметры:** `customer_id` (целое число) - ID пользователя.
    - **Возвращает:** Список словарей с информацией о доступах (если они найдены), иначе `None`.

13. **update_requested(customer_id: int, allowed_customer_id: int)** - используй каждый раз, когда пользователь выводит у себя календарь другого пользователя
    - **Описание:** Обновляет поле `requested` для указанного доступа.
    - **Входные параметры:** `customer_id` (целое число) - ID пользователя, `allowed_customer_id` (целое число) - ID пользователя, которому предоставлен доступ.
    - **Возвращает:** Не возвращает, а выводит сообщение об успешном обновлении данных или об ошибке.

14. **check_access(customer_id: int, allowed_customer_id: int)**
    - **Описание:** Проверяет наличие доступа между двумя пользователями.
    - **Входные параметры:** `customer_id` (целое число) - ID пользователя, `allowed_customer_id` (целое число) - ID пользователя, получившего доступ.
    - **Возвращает:** Словарь с информацией о доступе (если он найден), иначе `None`.

15. **update_access_end_time(customer_id: int, allowed_customer_id: int, type_access: str, end_time)**
    - **Описание:** Обновляет тип доступа и время окончания доступа между двумя пользователями.
    - **Входные параметры:** `customer_id` (целое число) - ID пользователя, `allowed_customer_id` (целое число) - ID пользователя, получившего доступ, `type_access` (строка) - тип доступа, `end_time` (datetime) - время окончания доступа.
    - **Возвращает:** Не возвращает, а выводит сообщение об успешном обновлении данных или об ошибке.


13. **refresh_requests()** (асинхронная функция) - нужна для разрабоки (в боте не используется)
    - **Описание:** Обновляет поле `requested` для всех доступов (асинхронно) (меняет все на false каждые 00:00:01 каждого дня.
    - **Входные параметры:** Отсутствуют.
    - **Возвращает:** Не возвращает, а выводит сообщение об успешном обновлении данных или об ошибке.


## Отчет о функциях из functions.py

**update_if_changed(customer_id: int, email: str, username: str, password: str)** - нужна для обновления базы данных календаря. Должна вызываться раз в 10 минут в программе.
  - **Описание:** Обновляет данные по календарю в таблице event
  - **Входные параметры:** думаю понятны.
  - **Возвращает:** True - если календарь был изменен, то есть нужно выводить сообщение пользователям, False - иначе.

**Дополнение:**
- Для того, чтобы зафиксировать, что пользователь видел календарь нужно использовать функцию update_requested()
- Для того, чтобы просмотреть каким пользователям нужно выводить сообщения об изменениях нужно использовать функцию get_access() и смотреть на параметр requested
- Для того, чтобы понять что изменения в базе были, нужно использовать функцию update_if_changed(), она должна вызываться раз в какое-то время.
